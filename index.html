<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Franse Plus-Value Calculator</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

<div class="container">
    <header>
        <h1>Franse Belasting Calculator</h1>
        <p class="subtitle">Bereken Plus-Value en netto winst bij verkoop vastgoed</p>
    </header>

    <div class="panel">
        <h2><i class="fas fa-home"></i> Verkoopgegevens</h2>
        
        <div class="grid-2">
            <div class="form-group">
                <label>Datum Verkoop (Acte Authentique)</label>
                <input type="date" id="saleDate" onchange="calculate()">
            </div>
            <div class="form-group">
                <label>Verkoopprijs in Akte (€)</label>
                <input type="number" id="sellingPrice" placeholder="Bijv. 450000" oninput="calculate()">
            </div>
        </div>

        <div class="form-group">
            <label>Makelaarskosten</label>
            <div class="mb-2">
                <select id="brokerPayer" onchange="toggleBrokerInput()">
                    <option value="vendeur">Verkoper betaalt (Charge Vendeur)</option>
                    <option value="acquereur">Koper betaalt (Charge Acquéreur)</option>
                    <option value="none">Geen makelaar</option>
                </select>
            </div>

            <div id="brokerSettings">
                <div class="mb-2">
                    <label style="display:inline; margin-right:15px;">
                        <input type="radio" name="brokerCalcType" value="percent" checked onchange="toggleBrokerCalcType()" style="width:auto;"> Percentage
                    </label>
                    <label style="display:inline;">
                        <input type="radio" name="brokerCalcType" value="fixed" onchange="toggleBrokerCalcType()" style="width:auto;"> Vast Bedrag
                    </label>
                </div>

                <div id="brokerPercentInput" class="mb-2">
                    <div style="display:flex; justify-content:space-between; font-size:0.8rem; color:#666;">
                        <span>4%</span>
                        <span id="brokerPercentDisplay" class="bold text-blue">5%</span>
                        <span>10%</span>
                    </div>
                    <input type="range" id="brokerPercentRange" min="4" max="10" step="0.5" value="5" oninput="updateBrokerPercentDisplay(); calculate()">
                </div>

                <div id="brokerFixedInput" class="hidden mb-2">
                    <input type="number" id="brokerFixedAmount" placeholder="Bedrag in €" oninput="calculate()">
                </div>
                
                <div class="text-right hint">
                    Berekende kosten: <span id="calculatedBrokerFee" class="bold">€ 0.00</span>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label>Diagnostics (DDT) / Landmeter (€)</label>
            <input type="number" id="diagnosticsCost" placeholder="Bijv. 600" oninput="calculate()">
            <span class="hint">Kosten voor verplichte keuringen zijn aftrekbaar.</span>
        </div>
    </div>

    <div class="panel">
        <h2><i class="fas fa-history"></i> Aankoopgegevens</h2>
        
        <div class="grid-2">
            <div class="form-group">
                <label>Datum Aankoop</label>
                <input type="date" id="purchaseDate" onchange="calculate()">
            </div>
            <div class="form-group">
                <label>Aankoopprijs (€)</label>
                <input type="number" id="purchasePrice" placeholder="Bijv. 250000" oninput="calculate()">
            </div>
        </div>

        <div class="form-group">
            <label>Postcode Object</label>
            <input type="text" id="postalCode" placeholder="Bijv. 24000" oninput="checkDepartment()">
            <span id="deptName" class="hint text-blue"></span>
        </div>

        <div class="grid-2">
            <div class="form-group">
                <label>Aankoopkosten (Notaris)</label>
                <select id="acquisitionCostType" onchange="toggleAcquisitionInput()" class="mb-2">
                    <option value="forfait">Forfaitair (7,5%)</option>
                    <option value="actual">Werkelijk bedrag</option>
                </select>
                <input type="number" id="acquisitionCostActual" class="hidden" placeholder="Vul werkelijk bedrag in" oninput="calculate()">
                <div id="acquisitionCostDisplay" class="hint bold">€ 0.00</div>
            </div>

            <div class="form-group">
                <label>Verbouwingen / Renovatie</label>
                <select id="renovationType" onchange="toggleRenovationInput()" class="mb-2">
                    <option value="forfait">Forfaitair (15% - mits >5 jaar)</option>
                    <option value="actual">Werkelijke kosten</option>
                </select>
                <input type="number" id="renovationCostActual" class="hidden" placeholder="Totaal facturen" oninput="calculate()">
                <div id="renovationCostDisplay" class="hint bold">€ 0.00</div>
                <p id="renovationWarning" class="hint text-red hidden"><i class="fas fa-exclamation-triangle"></i> Bezit < 5 jaar: geen forfait.</p>
            </div>
        </div>
    </div>

    <div class="terminal">
        <h4><i class="fas fa-calculator"></i> BEREKENING_RESULTAAT.LOG</h4>
        
        <div class="term-row">
            <span>Jaren bezit:</span>
            <span><span id="resSaleYear">----</span> - <span id="resPurchaseYear">----</span> = <span id="resYearsOwned" class="bg-green">0</span> jaar</span>
        </div>
        
        <div class="term-line"></div>

        <div class="term-row">
            <span>Netto Verkoopprijs:</span>
            <span id="resNetSelling">€ 0.00</span>
        </div>
        <div class="term-row text-dim">
            <span id="resBrokerNote" style="margin-left: 20px;">...</span>
        </div>

        <div class="term-row">
            <span>Gecorr. Aankoop:</span>
            <span id="resAdjustedPurchase">€ 0.00</span>
        </div>
        <div class="term-row text-dim">
            <span style="margin-left: 20px;">(Incl. notaris, verbouwing, diag)</span>
        </div>

        <div class="term-row mt-2">
            <span class="text-orange">BRUTO MEERWAARDE:</span>
            <span id="resGrossGain" class="text-orange">€ 0.00</span>
        </div>

        <div class="term-line"></div>
        
        <div class="term-row">
            <span>Inkomstenbelasting (IR 19%):</span>
            <span id="taxIR">€ 0.00</span>
        </div>
        <div class="term-row text-dim">
            <span style="margin-left: 20px;">Korting bezitsduur: <span id="discountIRPercentage">0%</span></span>
        </div>

        <div class="term-row mt-2">
            <span>Sociale Lasten (17.2%):</span>
            <span id="taxSoc">€ 0.00</span>
        </div>
        <div class="term-row text-dim">
            <span style="margin-left: 20px;">Korting bezitsduur: <span id="discountSocPercentage">0%</span></span>
        </div>

        <div id="surtaxeRow" class="term-row text-red mt-2 hidden">
            <span>Surtaxe (Hoge winst):</span>
            <span id="taxSurtaxe">€ 0.00</span>
        </div>

        <div class="term-line"></div>

        <div class="term-row">
            <span class="text-blue">TOTAAL BELASTING:</span>
            <span id="totalTax" class="text-blue">€ 0.00</span>
        </div>

        <div class="term-row mt-2">
            <span>NETTO OP REKENING:</span>
            <span id="netProceeds">€ 0.00</span>
        </div>

        <div class="term-line"></div>
        
        <div style="text-align: center; margin-top: 20px;">
            <div style="font-size: 0.9rem; color: #888;">WERKELIJKE WINST (Na aankoop)</div>
            <div id="realProfit" class="final-profit">€ 0.00</div>
        </div>
    </div>

</div>

<script>
    // Configuratie en data
    const TAX_RATE_IR = 0.19;
    const TAX_RATE_SOC = 0.172;

    // --- LOGICA FUNCTIES ---

    function getAbattement(yearsOwned) {
        let rateIR = 0;
        let rateSoc = 0;

        // IR Regels (Vrij na 22 jaar)
        if (yearsOwned >= 6 && yearsOwned <= 21) {
            rateIR = (yearsOwned - 5) * 0.06;
        } else if (yearsOwned === 22) {
            rateIR = 16 * 0.06 + 0.04; 
        } else if (yearsOwned > 22) {
            rateIR = 1.0;
        }

        // Sociale Lasten Regels (Vrij na 30 jaar)
        if (yearsOwned >= 6 && yearsOwned <= 21) {
            rateSoc = (yearsOwned - 5) * 0.0165;
        } else if (yearsOwned === 22) {
            rateSoc = 16 * 0.0165 + 0.0160;
        } else if (yearsOwned >= 23 && yearsOwned <= 30) {
            let base = (16 * 0.0165 + 0.0160); 
            rateSoc = base + ((yearsOwned - 22) * 0.09);
        } else if (yearsOwned > 30) {
            rateSoc = 1.0;
        }

        return {
            ir: Math.min(rateIR, 1.0),
            soc: Math.min(rateSoc, 1.0)
        };
    }

    function calculateSurtaxe(pvImposable) {
        if (pvImposable <= 50000) return 0;
        
        let rate = 0;
        if (pvImposable <= 60000) rate = 0.02 * ((pvImposable - 50000) / 10000);
        else if (pvImposable <= 100000) rate = 0.02;
        else if (pvImposable <= 110000) rate = 0.03 * ((pvImposable - 100000) / 10000) + 0.02;
        else if (pvImposable <= 150000) rate = 0.03;
        else if (pvImposable <= 160000) rate = 0.04 * ((pvImposable - 150000) / 10000) + 0.03;
        else if (pvImposable <= 200000) rate = 0.04;
        else if (pvImposable <= 210000) rate = 0.05 * ((pvImposable - 200000) / 10000) + 0.04;
        else if (pvImposable <= 250000) rate = 0.05;
        else if (pvImposable <= 260000) rate = 0.06 * ((pvImposable - 250000) / 10000) + 0.05;
        else rate = 0.06;

        return pvImposable * rate;
    }

    // --- UI INTERACTIE ---

    function toggleBrokerInput() {
        const payer = document.getElementById('brokerPayer').value;
        const settings = document.getElementById('brokerSettings');
        
        if (payer === 'none') {
            settings.classList.add('hidden');
        } else {
            settings.classList.remove('hidden');
        }
        calculate();
    }

    function toggleBrokerCalcType() {
        const type = document.querySelector('input[name="brokerCalcType"]:checked').value;
        if (type === 'percent') {
            document.getElementById('brokerPercentInput').classList.remove('hidden');
            document.getElementById('brokerFixedInput').classList.add('hidden');
        } else {
            document.getElementById('brokerPercentInput').classList.add('hidden');
            document.getElementById('brokerFixedInput').classList.remove('hidden');
        }
        calculate();
    }

    function updateBrokerPercentDisplay() {
        const val = document.getElementById('brokerPercentRange').value;
        document.getElementById('brokerPercentDisplay').innerText = val + '%';
    }

    function toggleAcquisitionInput() {
        const type = document.getElementById('acquisitionCostType').value;
        const input = document.getElementById('acquisitionCostActual');
        const display = document.getElementById('acquisitionCostDisplay');
        
        if (type === 'actual') {
            input.classList.remove('hidden');
            display.classList.add('hidden');
        } else {
            input.classList.add('hidden');
            display.classList.remove('hidden');
        }
        calculate();
    }

    function toggleRenovationInput() {
        const type = document.getElementById('renovationType').value;
        const input = document.getElementById('renovationCostActual');
        const display = document.getElementById('renovationCostDisplay');
        
        if (type === 'actual') {
            input.classList.remove('hidden');
            display.classList.add('hidden');
        } else {
            input.classList.add('hidden');
            display.classList.remove('hidden');
        }
        calculate();
    }

    function checkDepartment() {
        const input = document.getElementById('postalCode').value;
        const display = document.getElementById('deptName');
        if (input.length >= 2) {
            const deptCode = input.substring(0, 2);
            display.innerText = `Regio / Departement code: ${deptCode}`;
        } else {
            display.innerText = "";
        }
    }

    function formatCurrency(num) {
        return new Intl.NumberFormat('nl-NL', { style: 'currency', currency: 'EUR' }).format(num);
    }
    
    function formatPercent(num) {
        return (num * 100).toFixed(1) + '%';
    }

    // --- HOOFDBEREKENING ---
    function calculate() {
        const saleDateStr = document.getElementById('saleDate').value;
        const purchaseDateStr = document.getElementById('purchaseDate').value;
        const sellingPrice = parseFloat(document.getElementById('sellingPrice').value) || 0;
        const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
        
        // 1. Makelaarskosten berekenen
        let brokerFee = 0;
        const brokerPayer = document.getElementById('brokerPayer').value;
        
        if (brokerPayer !== 'none') {
            const brokerCalcType = document.querySelector('input[name="brokerCalcType"]:checked').value;
            if (brokerCalcType === 'percent') {
                const pct = parseFloat(document.getElementById('brokerPercentRange').value);
                brokerFee = sellingPrice * (pct / 100);
            } else {
                brokerFee = parseFloat(document.getElementById('brokerFixedAmount').value) || 0;
            }
        }
        document.getElementById('calculatedBrokerFee').innerText = formatCurrency(brokerFee);


        // Check of data compleet is voor berekening
        if (!saleDateStr || !purchaseDateStr || sellingPrice === 0 || purchasePrice === 0) return;

        // Datum logica
        const saleDate = new Date(saleDateStr);
        const purchaseDate = new Date(purchaseDateStr);
        let yearsOwned = saleDate.getFullYear() - purchaseDate.getFullYear();
        const m = saleDate.getMonth() - purchaseDate.getMonth();
        if (m < 0 || (m === 0 && saleDate.getDate() < purchaseDate.getDate())) {
            yearsOwned--;
        }
        
        document.getElementById('resSaleYear').innerText = saleDate.getFullYear();
        document.getElementById('resPurchaseYear').innerText = purchaseDate.getFullYear();
        document.getElementById('resYearsOwned').innerText = Math.max(0, yearsOwned);

        // --- STAP A: Bepaal Netto Verkoopprijs ---
        let netSellingPrice = sellingPrice;
        let brokerNote = "(excl. makelaar)";
        
        if (brokerPayer === 'vendeur') {
            netSellingPrice = sellingPrice - brokerFee;
            brokerNote = "(na aftrek makelaarskosten)";
        } else if (brokerPayer === 'acquereur') {
            netSellingPrice = sellingPrice;
            brokerNote = "(makelaar wordt betaald door koper)";
        } else {
             brokerNote = "(geen makelaar)";
        }
        
        document.getElementById('resNetSelling').innerText = formatCurrency(netSellingPrice);
        document.getElementById('resBrokerNote').innerText = brokerNote;

        // --- STAP B: Bepaal Gecorrigeerde Aankoopprijs ---
        // 1. Aankoopkosten (Notaris)
        let acqCost = 0;
        const acqType = document.getElementById('acquisitionCostType').value;
        if (acqType === 'actual') {
            acqCost = parseFloat(document.getElementById('acquisitionCostActual').value) || 0;
        } else {
            acqCost = purchasePrice * 0.075;
            document.getElementById('acquisitionCostDisplay').innerText = formatCurrency(acqCost);
        }

        // 2. Verbouwingen
        let renCost = 0;
        const renType = document.getElementById('renovationType').value;
        const renWarning = document.getElementById('renovationWarning');
        
        if (yearsOwned < 5) {
            renWarning.classList.remove('hidden');
            if (renType === 'forfait') {
                renCost = 0; 
                document.getElementById('renovationCostDisplay').innerText = "€ 0.00 (Nog geen 5 jaar bezit)";
            } else {
                renCost = parseFloat(document.getElementById('renovationCostActual').value) || 0;
            }
        } else {
            renWarning.classList.add('hidden');
            if (renType === 'forfait') {
                renCost = purchasePrice * 0.15;
                document.getElementById('renovationCostDisplay').innerText = formatCurrency(renCost);
            } else {
                renCost = parseFloat(document.getElementById('renovationCostActual').value) || 0;
            }
        }

        // 3. Diagnostics
        const diagCost = parseFloat(document.getElementById('diagnosticsCost').value) || 0;

        const adjustedPurchasePrice = purchasePrice + acqCost + renCost + diagCost;
        
        document.getElementById('resAdjustedPurchase').innerText = formatCurrency(adjustedPurchasePrice);

        // --- STAP C: Bruto Meerwaarde ---
        const grossGain = Math.max(0, netSellingPrice - adjustedPurchasePrice);
        document.getElementById('resGrossGain').innerText = formatCurrency(grossGain);

        // --- STAP D: Belastingberekening met Abattement ---
        const discounts = getAbattement(yearsOwned);
        
        // IR
        const taxableBaseIR = grossGain * (1 - discounts.ir);
        const taxIRAmount = taxableBaseIR * TAX_RATE_IR;

        // Sociale Lasten
        const taxableBaseSoc = grossGain * (1 - discounts.soc);
        const taxSocAmount = taxableBaseSoc * TAX_RATE_SOC;

        // Surtaxe
        const surtaxeAmount = calculateSurtaxe(taxableBaseIR);

        // Update UI Belastingen
        document.getElementById('discountIRPercentage').innerText = formatPercent(discounts.ir);
        document.getElementById('taxIR').innerText = formatCurrency(taxIRAmount);
        
        document.getElementById('discountSocPercentage').innerText = formatPercent(discounts.soc);
        document.getElementById('taxSoc').innerText = formatCurrency(taxSocAmount);

        if (surtaxeAmount > 0) {
            document.getElementById('surtaxeRow').classList.remove('hidden');
            document.getElementById('taxSurtaxe').innerText = formatCurrency(surtaxeAmount);
        } else {
            document.getElementById('surtaxeRow').classList.add('hidden');
        }

        const totalTax = taxIRAmount + taxSocAmount + surtaxeAmount;
        document.getElementById('totalTax').innerText = formatCurrency(totalTax);

        // --- STAP E: Eindresultaten ---
        // Netto Opbrengst (Cash in hand)
        let cashInHand = 0;
        // Als verkoper makelaar betaalt, is netSellingPrice al verminderd met makelaar.
        // Dus we trekken alleen de belasting er nog af.
        cashInHand = netSellingPrice - totalTax;

        document.getElementById('netProceeds').innerText = formatCurrency(cashInHand);

        // Werkelijke Winst
        const realProfit = cashInHand - purchasePrice;
        document.getElementById('realProfit').innerText = formatCurrency(realProfit);
    }
    
    // Start
    calculate();
</script>

</body>
</html>
